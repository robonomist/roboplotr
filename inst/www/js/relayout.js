function getVerticalLayout(e,t,i=!1,a,n,l=!1){let g=$(e).find("svg.main-svg")[0].height.animVal.value,o=$(e).find("g.g-gtitle")[0].getBBox(),r=0;"rangeslider"in e.layout.xaxis&&!0==e.layout.xaxis.rangeslider.visible&&(r=$(e).find("g.infolayer > g.rangeslider-container")[0].getBBox().height);let s=$(e).find("g.xaxislayer-above");s=s.length>0?s[0].getBBox().height:0;let y=o.height+30,h=$(e).find("g.annotation")[0].getBBox().height,d=$(e).find("g.g-xtitle");d=d.length>0?1.3*d[0].getBBox().height:0;let f={width:0,height:15};void 0!=$(e).find("g.legend")[0]&&(f.height=Math.ceil($(e).find("g.legend")[0].getBBox().height+5),f.width=$(e).find("g.legend")[0].getBBox().width);let u=f.height+(2*h+s+d),x=n?g-u-y:$(e).find(".gridlayer");x.length>0&&(x=x[0].getBBox().height),0==x&&(x=1);let v=.05*g/x;e.layout.images[0].sizey=v;let c=-((s+5+2*r+d)/x);if(c<-2||f.height>2*x){Plotly.relayout(e,{showlegend:!1}),"rangeslider"in e.layout.xaxis&&!0==e.layout.xaxis.rangeslider.visible&&Plotly.relayout(e,{"xaxis.rangeslider.visible":!1}),r=0;let B=$(e).find("g.xaxislayer-above");B=B.length>0?B[0].getBBox().height:0,void 0!=$(e).find("g.legend")[0]&&(f.height=Math.ceil($(e).find("g.legend")[0].getBBox().height+5),f.width=$(e).find("g.legend")[0].getBBox().width),u=f.height+h+B+d;let m=n?g-u-y:$(e).find(".gridlayer");m.length>0&&(m=m[0].getBBox().height),0==m&&(m=1),v=.05*g/m,c=-((u-h)/m)}$(e).find("g.layer-above > g.imagelayer")[0].getBBox().height;let p=-((f.height+2*r+1.5*h+s+d)/x),b=-((f.height+2*r+s+1.25*h+d)/x),_=f.height>x/2?t-2:t;_=f.width>$(e).find("svg.main-svg")[0].width.animVal.value?_-2:_;let z=t;if($(e).find("g.yaxislayer-above").length>0){let w=[...$(e).find("g.ytick")].reduce((e,t)=>e+t.getBBox().height,0);z=x<=w?Math.floor(.8*e.layout.yaxis.tickfont.size):Math.min(Math.floor(1.5*e.layout.yaxis.tickfont.size),t)}!0==l&&console.log("legend ht: "+f.height+" slider ht: "+r+" plot area ht: "+x+" plot caption ht: "+h+" bottom margin: "+u+" container ht: "+g," legend position: "+c," caption position: "+p);let V={"title.y":(g-40)/g,"legend.y":c,"images[0].y":b,"images[0].sizey":v,"margin.t":y,"margin.b":u,"annotations[0].y":p,"legend.font.size":_,"yaxis.tickfont.size":z};return a.reduce(function(e,t){return t in V&&(e[t]=V[t]),e},{})}function setVerticalLayout(e,t,i,a,n){if("width"in e|"autosize"in e){"rangeslider"in t.layout.xaxis&&!1==t.layout.xaxis.rangeslider.visible&&(t.layout.xaxis.rangeslider.visible=!0);let l="<span>"+(a[2]?"<b>":"")+a[0]+(a[2]?"</b>":"")+"<br><span style='font-size: 75%'>"+a[1]+"</span></span>";Plotly.relayout(t,{"title.text":l,showlegend:!0});let g=$(t).find("g.g-gtitle")[0].getBBox().width,o=n?$(t).find("g.layer-above"):$(t).find(".cartesianlayer > .xy > .gridlayer");o.length>0&&(o=o[0].getBBox().width),o<=g&&(l="<span>"+(a[2]?"<b>":"")+stringDivider(a[0],Math.floor(o/(t.layout.title.font.size-8)),"<br>")+(a[2]?"</b>":"")+"<br><span style='font-size: 75%'>"+a[1]+"</span></span>",Plotly.relayout(t,{"title.text":l})),Plotly.relayout(t,getVerticalLayout(t,i,!1,keys=["legend.font.size","margin.t","margin.b","legend.y","yaxis.tickfont.size"],n)),Plotly.relayout(t,getVerticalLayout(t,i,!1,keys=["margin.t","margin.b","images[0].sizey","images[0].y","yaxis.tickfont.size"],n)),!1==t.layout.showlegend&&Plotly.relayout(t,getVerticalLayout(t,i,!1,keys=["margin.t","margin.b","images[0].sizey","images[0].y","yaxis.tickfont.size"],n)),Plotly.relayout(t,getVerticalLayout(t,i,!1,keys=["images[0].y","annotations[0].y","legend.y","title.y","yaxis.tickfont.size"],n))}}function stringDivider(e,t,i){if(e.length>t){let a=t;for(;a>0&&" "!=e[a];a--);if(!(a>0))return e.replace(/( ){1,}/ig,i);{let n;return e.substring(0,a)+i+stringDivider(e.substring(a+1),t,i)}}return e}function yrangeRelayout(e,t,i,a){if("[object Array]"===Object.prototype.toString.call(e["xaxis.range"])){var n=t.layout.xaxis.range;t.layout.yaxis.range;var l=[];let g=[];if(t.data.filter(e=>!0===e.visible||!e.hasOwnProperty("visible")).forEach(e=>{for(var t=e.y.length,i=0;i<t;i++){var a=e.x[i],o=e.y[i];if(a>=n[0]&&a<=n[1]&&(l.push(o),"bar"==e.type)){let r={date:a,val:o};g.push(r)}}}),!0==a){var o={};g.forEach(function(e){o.hasOwnProperty(e.date)&&e.val>0?o[e.date]=o[e.date]+e.val:e.val>0&&(o[e.date]=e.val)});var r={};for(var s in g.forEach(function(e){r.hasOwnProperty(e.date)&&e.val<=0?r[e.date]=r[e.date]+e.val:e.val<=0&&(r[e.date]=e.val)}),g=[{val:0}],r)g.push({date:s,val:r[s]});for(var s in o)g.push({date:s,val:o[s]});l=l.concat(g.map(e=>e.val))}let y=Math.max(...l);y=y<0?.95*y:1.05*y;let h=Math.min(...l);if(h=h<0?1.05*h:.95*h,"shapes"in t.layout)var d={"yaxis.range":[h,y],"shapes[0].x0":n[0]};else var d={"yaxis.range":[h,y]};Plotly.relayout(t,d),i>=0&&window.clearTimeout(i),i=window.setTimeout(function(){i=-1},800)}}function plotlyRelayoutEventFunction(e,t,i,a,n,l){timerId=0,setVerticalLayout(e,t,i,a,l),yrangeRelayout(e,t,timerId,n)}
