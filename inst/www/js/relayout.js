function getVerticalLayout(t,e,i,a,l,n=void 0,o=!1){var r=$(t).find("svg.main-svg")[0].height.animVal.value,g=$(t).find("g.g-gtitle")[0].getBBox();let s=0;"rangeslider"in t.layout.xaxis&&1==t.layout.xaxis.rangeslider.visible&&(s=$(t).find("g.infolayer > g.rangeslider-container")[0].getBBox().height);var h=l?5:0;let y=$(t).find("g.xaxislayer-above");y=0<y.length?y[0].getBBox().height:h;let d=0;var u=$(t).find("div.modebar");0<u.length&&(d=u[0].clientHeight);var f=g.height+d+11,u=$(t).find("g.annotation")[0].getBBox().height+5;let c=$(t).find("g.g-xtitle");c=0<c.length?1.3*c[0].getBBox().height:0;let x={width:0,height:0};null!=$(t).find("g.legend")[0]&&(x.height=Math.ceil($(t).find("g.legend")[0].getBBox().height+5),x.width=$(t).find("g.legend")[0].getBBox().width);let p=x.height+(u+y+c+ +s),v=l?$(t).find(".pielayer"):$(t).find(".gridlayer");0<v.length&&(v=v[0].getBBox()),l&&(v.height=r-p-f),0==v.height&&(v.height=1);g=$(t).find("g.layer-above > g.imagelayer > image")[0].getBBox();p+=logoSpace(n,g,p,c,y,x);let b=.05*r/v.height;t.layout.images[0].sizey=b;let m=-((y+5+2*s+c)/v.height);if(m<-2||v.height<r/4){"rangeslider"in t.layout.xaxis&&1==t.layout.xaxis.rangeslider.visible?Plotly.relayout(t,{showlegend:!1,"xaxis.rangeslider.visible":!1}):Plotly.relayout(t,{showlegend:!1}),s=0,y=$(t).find("g.xaxislayer-above"),y=0<y.length?y[0].getBBox().height:h,p=u+y+c,p=logoSpace(n,g,p,c,y,x);let e=l?$(t).find(".pielayer"):$(t).find(".gridlayer");0<e.length&&(e=e[0].getBBox().height),0==e.height&&(e.height=1),b=.05*r/e.height,m=-((p-u)/e.height)}else v.height>r/2&0==t.layout.showlegend&&Plotly.relayout(t,{showlegend:!0});h=(r-(21+d))/r;let B=0==y?-u:0;B=0==x.height?B-5:B;n=-((p+s+B)/v.height),g=n,l=n;let w=x.height>v.height/2?e-2:e;w=x.width>$(t).find("svg.main-svg")[0].width.animVal.value?w-2:w;let z=e;0<$(t).find("g.yaxislayer-above").length&&(n=[...$(t).find("g.ytick")].reduce((e,t)=>e+t.getBBox().height,0),z=v.height<=n?Math.floor(.8*t.layout.yaxis.tickfont.size):Math.min(Math.floor(1.5*t.layout.yaxis.tickfont.size),e)),1==o&&console.log("legend ht: "+x.height+" slider ht: "+s+" plot area ht: "+v.height+" plot caption ht: "+u+" bottom margin: "+p+" container ht: "+r," legend position: "+m," caption position: "+g);var k={"title.y":h,"legend.y":m,"images[0].y":l,"images[0].sizey":b,"margin.t":f,"margin.b":p,"annotations[0].y":g,"legend.font.size":w,"yaxis.tickfont.size":z};return a.reduce(function(e,t){return t in k&&(e[t]=k[t]),e},{})}function calculateDisplayedImageSize(e,t){let i,a;return e<t.width/t.height?(a=t.height,i=a*e):(i=t.width,a=i/e),{width:Math.round(i),height:Math.round(a)}}function logoSpace(e,t,i,a,l,n){e=calculateDisplayedImageSize(e,t);let o=[];return o.horizontal=t.width-n.width-e.width,o.vertical=i-(a+l+n.height)-e.height,Object.values(o).every(e=>e<0)?-o.vertical:0}function setVerticalLayout(i,a,l,n,o,r=void 0){if("width"in i|"autosize"in i){"rangeslider"in a.layout.xaxis&&0==a.layout.xaxis.rangeslider.visible&&(a.layout.xaxis.rangeslider.visible=!0);var g="<span>"+(n[2]?"<b>":"")+n[0]+(n[2]?"</b>":"")+(0==n[0].length?"":"<br>")+"<span style='font-size: 75%'>"+n[1]+"</span></span>",i=a.layout.annotations[0].text.replace(new RegExp("<br class = 'roboplotr-breaker'>","g")," ");Plotly.relayout(a,{"title.text":g,"annotations[0].text":i});i=$(a).find("g.g-gtitle")[0].getBBox().width;let e=o?$(a).find("g.layer-above"):$(a).find(".cartesianlayer > .xy > .gridlayer");0<e.length&&(e=e[0].getBBox().width);let t=getVerticalLayout(a,l,!1,keys=["legend.font.size","margin.t","margin.b","legend.y","yaxis.tickfont.size"],o,r);e<=i&&(g="<span>"+(n[2]?"<b>":"")+stringDivider(n[0],Math.floor(e/(a.layout.title.font.size-8)),"<br class = 'roboplotr-breaker'>")+(n[2]?"</b>":"")+"<br><span style='font-size: 75%'>"+n[1]+"</span></span>",t["title.text"]=g),Plotly.relayout(a,t);calculateDisplayedImageSize(r,$(a).find("g.layer-above > g.imagelayer > image")[0].getBBox()).width;t=getVerticalLayout(a,l,!1,keys=["legend.font.size","margin.t","margin.b","yaxis.tickfont.size","images[0].sizey"],o,r),t=findCaptionSpace(a,r,o,t,e),Plotly.relayout(a,t),t=getVerticalLayout(a,l,!1,keys=["legend.font.size","margin.t","margin.b","yaxis.tickfont.size","images[0].sizey"],o,r),t=findCaptionSpace(a,r,o,t,e),Plotly.relayout(a,t),Plotly.relayout(a,getVerticalLayout(a,l,!1,keys=["images[0].y","annotations[0].y","margin.t","margin.b","legend.y","images[0].sizey","yaxis.tickfont.size"],o,r)),Plotly.relayout(a,getVerticalLayout(a,l,!1,keys=["images[0].y","annotations[0].y","legend.y","margin.b","title.y"],o,r))}}function findCaptionSpace(e,t,i,a,l){let n;$(e).find("g.annotation")[0].getBBox().width;var o=e.layout.annotations[0].text.replace(new RegExp("<br class = 'roboplotr-breaker'>","g")," ");return n=i?l:(l=$(e).find(".gridlayer")[0].getBBox().width,t=calculateDisplayedImageSize(t,$(e).find("g.layer-above > g.imagelayer > image")[0].getBBox()).width,Math.max(l-t,Math.round(t/2))),a["annotations[0].text"]=stringDivider(o,Math.floor(n/(e.layout.annotations[0].font.size/2)),"<br class = 'roboplotr-breaker'>"),a}function findShapeById(e,t){var i=e.layout.shapes||[];for(let e=0;e<i.length;e++)if(i[e].shapeId===t)return e;return null}function editShapes(a,l){var e=findShapeById(a,"shadearea");null!==e&&(a.layout.shapes[e].y0=a.layout.yaxis.range[0],a.layout.shapes[e].y1=a.layout.yaxis.range[1]);var n=findShapeById(a,"zeroline");null!==n&&(a.layout.shapes[n].x0=a.layout.xaxis.range[0],a.layout.shapes[n].x1=a.layout.xaxis.range[1]),null!==n|null!==e&&Plotly.redraw(a),null!==n&&a.on("plotly_afterplot",function(){let e=$(a).find("g.ytick text"),t=$(a).find("path.zl");if(0==l)0<t.length&&(t[0].style.stroke=a.layout.shapes[n].line.color);else{let i;0<t.length&&(t[0].style.stroke=a.layout.yaxis.gridcolor),e.filter(function(e,t){if(this.textContent.trim().replace(",",".").replace("âˆ’","-").replace(" ","")==l){i=t.getAttribute("transform");let e=$(a).find("path.ygrid");e.filter(function(e,t){t.getAttribute("transform")==i&&(t.style.stroke=a.layout.shapes[n].line.color)})}})}})}function stringDivider(t,i,a){if(t.length>i){let e=i;for(;0<e&&" "!=t[e];e--);if(0<e)return t.substring(0,e)+a+stringDivider(t.substring(e+1),i,a);i=/( ){1,}/gi;return t.replace(i,a)}return t}function yrangeRelayout(e,i,a,l){if("[object Array]"===Object.prototype.toString.call(e["xaxis.range"])){var o=i.layout.xaxis.range,r=(i.layout.yaxis.range,[]);let n=[];if(i.data.filter(e=>!0===e.visible||!e.hasOwnProperty("visible")).forEach(e=>{for(var t=e.y.length,i=0;i<t;i++){var a=e.x[i],l=e.y[i];a>=o[0]&&a<=o[1]&&(r.push(l),"bar"==e.type&&(l={date:a,val:l},n.push(l)))}}),1==l){var g={};n.forEach(function(e){g.hasOwnProperty(e.date)&&0<e.val?g[e.date]=g[e.date]+e.val:0<e.val&&(g[e.date]=e.val)});var s,h={};for(s in n.forEach(function(e){h.hasOwnProperty(e.date)&&e.val<=0?h[e.date]=h[e.date]+e.val:e.val<=0&&(h[e.date]=e.val)}),n=[{val:0}],h)n.push({date:s,val:h[s]});for(s in g)n.push({date:s,val:g[s]});r=r.concat(n.map(e=>e.val))}let e=Math.max(...r);e=e<0?.95*e:1.05*e;let t=Math.min(...r);t=t<0?1.05*t:.95*t,l=null!=findShapeById(i,"zeroline")?{"yaxis.range":[t,e],"shapes[zline].x0":o[0]}:{"yaxis.range":[t,e]},Plotly.relayout(i,l),0<=a&&window.clearTimeout(a),a=window.setTimeout(function(){a=-1},800)}}function plotlyRelayoutEventFunction(e,t,i,a,l,n,o){timerId=0,setVerticalLayout(e,t,i,a,n,o),yrangeRelayout(e,t,timerId,l)}
