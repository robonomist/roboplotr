function getVerticalLayout(e,t,i=!1,a,l,n=!1){let g=$(e).find("svg.main-svg")[0].height.animVal.value,o=$(e).find("g.g-gtitle")[0].getBBox(),r=0;"rangeslider"in e.layout.xaxis&&1==e.layout.xaxis.rangeslider.visible&&(r=$(e).find("g.infolayer > g.rangeslider-container")[0].getBBox().height);let s=$(e).find("g.xaxislayer-above");s=s.length>0?s[0].getBBox().height:0;let y=o.height+30,h=$(e).find("g.annotation")[0].getBBox().height,d=$(e).find("g.g-xtitle");d=d.length>0?1.3*d[0].getBBox().height:0;let f={width:0,height:15};null!=$(e).find("g.legend")[0]&&(f.height=Math.ceil($(e).find("g.legend")[0].getBBox().height+5),f.width=$(e).find("g.legend")[0].getBBox().width);let u=f.height+(2*h+s+d),x=l?g-u-y:$(e).find(".gridlayer");x.length>0&&(x=x[0].getBBox().height),0==x&&(x=1);let c=.05*g/x;e.layout.images[0].sizey=c;let v=-(s+5+2*r+d)/x;if(v<-2||f.height>2*x){Plotly.relayout(e,{showlegend:!1}),"rangeslider"in e.layout.xaxis&&1==e.layout.xaxis.rangeslider.visible&&Plotly.relayout(e,{"xaxis.rangeslider.visible":!1}),r=0;let t=$(e).find("g.xaxislayer-above");t=t.length>0?t[0].getBBox().height:0,null!=$(e).find("g.legend")[0]&&(f.height=Math.ceil($(e).find("g.legend")[0].getBBox().height+5),f.width=$(e).find("g.legend")[0].getBBox().width),u=f.height+h+t+d;let i=l?g-u-y:$(e).find(".gridlayer");i.length>0&&(i=i[0].getBBox().height),0==i&&(i=1),c=.05*g/i,v=-(u-h)/i}$(e).find("g.layer-above > g.imagelayer")[0].getBBox().height;let B=(g-40)/g,m=-(f.height+2*r+1.5*h+s+d)/x,b=-(f.height+2*r+s+1.25*h+d)/x,p=f.height>x/2?t-2:t;p=f.width>$(e).find("svg.main-svg")[0].width.animVal.value?p-2:p;let w=t;if($(e).find("g.yaxislayer-above").length>0){w=x<=[...$(e).find("g.ytick")].reduce(((e,t)=>e+t.getBBox().height),0)?Math.floor(.8*e.layout.yaxis.tickfont.size):Math.min(Math.floor(1.5*e.layout.yaxis.tickfont.size),t)}1==n&&console.log("legend ht: "+f.height+" slider ht: "+r+" plot area ht: "+x+" plot caption ht: "+h+" bottom margin: "+u+" container ht: "+g," legend position: "+v," caption position: "+m);let z={"title.y":B,"legend.y":v,"images[0].y":b,"images[0].sizey":c,"margin.t":y,"margin.b":u,"annotations[0].y":m,"legend.font.size":p,"yaxis.tickfont.size":w};return a.reduce((function(e,t){return t in z&&(e[t]=z[t]),e}),{})}function setVerticalLayout(e,t,i,a,l){if("width"in e|"autosize"in e){"rangeslider"in t.layout.xaxis&&0==t.layout.xaxis.rangeslider.visible&&(t.layout.xaxis.rangeslider.visible=!0);let e="<span>"+(a[2]?"<b>":"")+a[0]+(a[2]?"</b>":"")+(0==a[0].length?"":"<br>")+"<span style='font-size: 75%'>"+a[1]+"</span></span>";Plotly.relayout(t,{"title.text":e,showlegend:!0});let n=$(t).find("g.g-gtitle")[0].getBBox().width,g=l?$(t).find("g.layer-above"):$(t).find(".cartesianlayer > .xy > .gridlayer");g.length>0&&(g=g[0].getBBox().width),g<=n&&(e="<span>"+(a[2]?"<b>":"")+stringDivider(a[0],Math.floor(g/(t.layout.title.font.size-8)),"<br>")+(a[2]?"</b>":"")+"<br><span style='font-size: 75%'>"+a[1]+"</span></span>",Plotly.relayout(t,{"title.text":e})),Plotly.relayout(t,getVerticalLayout(t,i,!1,keys=["legend.font.size","margin.t","margin.b","legend.y","yaxis.tickfont.size"],l)),Plotly.relayout(t,getVerticalLayout(t,i,!1,keys=["margin.t","margin.b","images[0].sizey","images[0].y","yaxis.tickfont.size"],l)),0==t.layout.showlegend&&Plotly.relayout(t,getVerticalLayout(t,i,!1,keys=["margin.t","margin.b","images[0].sizey","images[0].y","yaxis.tickfont.size"],l)),Plotly.relayout(t,getVerticalLayout(t,i,!1,keys=["images[0].y","annotations[0].y","legend.y","title.y","yaxis.tickfont.size"],l))}}function stringDivider(e,t,i){if(e.length>t){let a=t;for(;a>0&&" "!=e[a];a--);if(a>0){return e.substring(0,a)+i+stringDivider(e.substring(a+1),t,i)}{let t=/( ){1,}/gi;return e.replace(t,i)}}return e}function yrangeRelayout(e,t,i,a){if("[object Array]"===Object.prototype.toString.call(e["xaxis.range"])){var l=t.layout.xaxis.range,n=(t.layout.yaxis.range,[]);let e=[];if(t.data.filter((e=>!0===e.visible||!e.hasOwnProperty("visible"))).forEach((t=>{for(var i=t.y.length,a=0;a<i;a++){var g=t.x[a],o=t.y[a];if(g>=l[0]&&g<=l[1]&&(n.push(o),"bar"==t.type)){let t={date:g,val:o};e.push(t)}}})),1==a){var g={};e.forEach((function(e){g.hasOwnProperty(e.date)&&e.val>0?g[e.date]=g[e.date]+e.val:e.val>0&&(g[e.date]=e.val)}));var o={};for(var r in e.forEach((function(e){o.hasOwnProperty(e.date)&&e.val<=0?o[e.date]=o[e.date]+e.val:e.val<=0&&(o[e.date]=e.val)})),e=[{val:0}],o)e.push({date:r,val:o[r]});for(var r in g)e.push({date:r,val:g[r]});n=n.concat(e.map((e=>e.val)))}let y=Math.max(...n);y=y<0?.95*y:1.05*y;let h=Math.min(...n);if(h=h<0?1.05*h:.95*h,"shapes"in t.layout)var s={"yaxis.range":[h,y],"shapes[0].x0":l[0]};else s={"yaxis.range":[h,y]};Plotly.relayout(t,s),i>=0&&window.clearTimeout(i),i=window.setTimeout((function(){i=-1}),800)}}function plotlyRelayoutEventFunction(e,t,i,a,l,n){timerId=0,setVerticalLayout(e,t,i,a,n),yrangeRelayout(e,t,timerId,l)}
