function getVerticalLayout(l,e,t,i,g,o=void 0,a=!1){var r=$(l).find("svg.main-svg")[0].height.animVal.value,s=$(l).find("g.g-gtitle")[0].getBBox(),n=0<$(l).find("g.xy2").length,h=0<$(l).find("g.g-y2title").length;let d=0;"rangeslider"in l.layout.xaxis&&1==l.layout.xaxis.rangeslider.visible&&(d=$(l).find("g.infolayer > g.rangeslider-container")[0].getBBox().height);var y=g?5:0;let f=$(l).find("g.xaxislayer-above");f=0<f.length?f[0].getBBox().height:y;let u=0;var x=$(l).find("div.modebar");0<x.length&&(u=x[0].clientHeight);let c=5;n&&(p=$(l).find("g.overaxes-above > g.xy2-y")[0].getBBox(),v=h?$(l).find("g.g-y2title")[0].getBBox().width:0,c=p.width+5+v);var p=s.height+u+11,v=$(l).find("g.annotation")[0].getBBox().height+5;let B=$(l).find("g.g-xtitle");B=0<B.length?1.3*B[0].getBBox().height:0;let m={width:0,height:0};null!=$(l).find("g.legend")[0]&&(m.height=Math.ceil($(l).find("g.legend")[0].getBBox().height),m.width=$(l).find("g.legend")[0].getBBox().width);let b=m.height+10+(v+f+B+ +d),w=g?$(l).find(".pielayer"):$(l).find(".gridlayer");0<w.length&&(w=w[0].getBBox()),g&&(w.height=r-b-p),0==w.height&&(w.height=1);let z=$(l).find("g.layer-above > g.imagelayer > image")[0].getBBox();b+=logoSpace(o,z,b,B,f,m);let k=.05*r/w.height;l.layout.images[0].sizey=k;let S=-((f+5+2*d+B)/w.height);if(S<-2||w.height<r/4){"rangeslider"in l.layout.xaxis&&1==l.layout.xaxis.rangeslider.visible?Plotly.relayout(l,{showlegend:!1,"xaxis.rangeslider.visible":!1}):Plotly.relayout(l,{showlegend:!1}),d=0,f=$(l).find("g.xaxislayer-above"),f=0<f.length?f[0].getBBox().height:y,b=10+v+f+B,b+=logoSpace(o,z,b,B,f,m);let e=g?$(l).find(".pielayer"):$(l).find(".gridlayer");0<e.length&&(e=e[0].getBBox().height),0==e.height&&(e.height=1),k=.05*r/e.height,S=-((b-v)/e.height)}else if(w.height>r/1.5&0==l.layout.showlegend){"rangeslider"in l.layout.xaxis&&0==l.layout.xaxis.rangeslider.visible?Plotly.relayout(l,{showlegend:!0,"xaxis.rangeslider.visible":!0}):Plotly.relayout(l,{showlegend:!0});let e=0;"rangeslider"in l.layout.xaxis&&1==l.layout.xaxis.rangeslider.visible&&(e=$(l).find("g.infolayer > g.rangeslider-container")[0].getBBox().height);var P=g?5:0;let t=$(l).find("g.xaxislayer-above");t=0<t.length?t[0].getBBox().height:P;let i=0;var I=$(l).find("div.modebar");0<I.length&&(i=I[0].clientHeight);P=s.height+i+11,I=$(l).find("g.annotation")[0].getBBox().height+5;let a=$(l).find("g.g-xtitle");a=0<a.length?1.3*a[0].getBBox().height:0;let n={width:0,height:0};null!=$(l).find("g.legend")[0]&&(n.height=Math.ceil($(l).find("g.legend")[0].getBBox().height),n.width=$(l).find("g.legend")[0].getBBox().width),b=n.height+10+(I+t+a+ +e),b+=logoSpace(o,z,b,a,t,n),w=g?$(l).find(".pielayer"):$(l).find(".gridlayer"),0<w.length&&(w=w[0].getBBox()),g&&(w.height=r-b-P),0==w.height&&(w.height=1),z=$(l).find("g.layer-above > g.imagelayer > image")[0].getBBox(),k=.05*r/w.height,l.layout.images[0].sizey=k,S=-((t+5+2*e+a)/w.height)}I=(r-(21+u))/r,o=0==f?-v:0;w=g?$(l).find(".pielayer"):$(l).find(".gridlayer"),0<w.length&&(w=w[0].getBBox()),g&&(w.height=r-b-p),0==w.height&&(w.height=1);P=-((b+d+o)/w.height),g=P,o=P;let M=m.height>w.height/2?e.legend-2:e.legend;M=m.width>$(l).find("svg.main-svg")[0].width.animVal.value?M-2:M;let L=e.y;0<$(l).find("g.yaxislayer-above").length&&(P=[...$(l).find("g.ytick")].reduce((e,t)=>e+t.getBBox().height,0),L=w.height<=P?Math.floor(.8*l.layout.yaxis.tickfont.size):Math.min(Math.floor(1.5*l.layout.yaxis.tickfont.size),e.y)),1==a&&console.log("legend ht: "+m.height+" slider ht: "+d+" plot area ht: "+w.height+" plot caption ht: "+v+" bottom margin: "+b+" container ht: "+r," legend position: "+S," caption position: "+g);var V={"title.y":I,"legend.y":S,"images[0].y":o,"images[0].sizey":k,"margin.t":p,"margin.b":b,"margin.r":c,"annotations[0].y":g,"legend.font.size":M,"yaxis.tickfont.size":L,"yaxis2.tickfont.size":L};return i.reduce(function(e,t){return t in V&&(e[t]=V[t]),e},{})}function calculateDisplayedImageSize(e,t){let i,a;return e<t.width/t.height?(a=t.height,i=a*e):(i=t.width,a=i/e),{width:Math.round(i),height:Math.round(a)}}function logoSpace(e,t,i,a,n,l){e=calculateDisplayedImageSize(e,t);let g=[];return g.horizontal=t.width-l.width-e.width,g.vertical=i-(a+n+l.height)-e.height,Object.values(g).every(e=>e<0)?-g.vertical:0}function adjustLegendItems(e){let t=e.data.filter(e=>!0===e.visible||!e.hasOwnProperty("visible")),a=$(e).find(".legend .legendtext");t.forEach(e=>{let t=a.filter(function(){return $(this).text()===e.name});var i;0<t.length&&(i=t[0].getBBox().width,e.legendwidth=Math.round(1.05*i))})}function setVerticalLayout(i,a,n,l,g,o=void 0){if("width"in i|"autosize"in i){"rangeslider"in a.layout.xaxis&&0==a.layout.xaxis.rangeslider.visible&&(a.layout.xaxis.rangeslider.visible=!0);var r="<span>"+(l[2]?"<b>":"")+l[0]+(l[2]?"</b>":"")+(0==l[0].length?"":"<br>")+"<span style='font-size: 75%'>"+l[1]+"</span></span>",i=a.layout.annotations[0].text.replace(new RegExp("<br class = 'roboplotr-breaker'>","g")," ");Plotly.relayout(a,{"title.text":r,"annotations[0].text":i});i=$(a).find("g.g-gtitle")[0].getBBox().width;let e=g?$(a).find("g.layer-above"):$(a).find(".cartesianlayer > .xy > .gridlayer");0<e.length&&(e=e[0].getBBox().width);let t=getVerticalLayout(a,n,!1,keys=["legend.font.size","margin.t","margin.b","legend.y","yaxis.tickfont.size","yaxis2.tickfont.size"],g,o);e<=i&&(r="<span>"+(l[2]?"<b>":"")+stringDivider(l[0],Math.floor(e/(a.layout.title.font.size-8)),"<br class = 'roboplotr-breaker'>")+(l[2]?"</b>":"")+"<br><span style='font-size: 75%'>"+l[1]+"</span></span>",t["title.text"]=r),adjustLegendItems(a),Plotly.relayout(a,t);calculateDisplayedImageSize(o,$(a).find("g.layer-above > g.imagelayer > image")[0].getBBox()).width;t=getVerticalLayout(a,n,!1,keys=["legend.font.size","margin.t","margin.b","margin.r","yaxis.tickfont.size","yaxis2.tickfont.size","images[0].sizey"],g,o),t=findCaptionSpace(a,o,g,t,e),Plotly.relayout(a,t),t=getVerticalLayout(a,n,!1,keys=["legend.font.size","margin.t","margin.b","yaxis.tickfont.size","yaxis2.tickfont.size","images[0].sizey"],g,o),t=findCaptionSpace(a,o,g,t,e),adjustLegendItems(a),Plotly.relayout(a,t),Plotly.relayout(a,getVerticalLayout(a,n,!1,keys=["images[0].y","annotations[0].y","margin.t","margin.b","legend.y","images[0].sizey","yaxis.tickfont.size","yaxis2.tickfont.size"],g,o)),Plotly.relayout(a,getVerticalLayout(a,n,!1,keys=["images[0].y","annotations[0].y","legend.y","margin.b","margin.r","title.y","yaxis.tickfont.size","yaxis2.tickfont.size"],g,o))}}function findCaptionSpace(e,t,i,a,n){let l;$(e).find("g.annotation")[0].getBBox().width;var g=e.layout.annotations[0].text.replace(new RegExp("<br class = 'roboplotr-breaker'>","g")," ");return l=i?n:(n=$(e).find(".gridlayer")[0].getBBox().width,t=calculateDisplayedImageSize(t,$(e).find("g.layer-above > g.imagelayer > image")[0].getBBox()).width,Math.max(n-t,Math.round(t/2))),a["annotations[0].text"]=stringDivider(g,Math.floor(l/(e.layout.annotations[0].font.size/2)),"<br class = 'roboplotr-breaker'>"),a}function findShapeById(e,t){var i=e.layout.shapes||[];for(let e=0;e<i.length;e++)if(i[e].shapeId===t)return e;return null}function editShapes(a,n){var e=findShapeById(a,"shadearea");null!==e&&(a.layout.shapes[e].y0=a.layout.yaxis.range[0],a.layout.shapes[e].y1=a.layout.yaxis.range[1]);var l=findShapeById(a,"zeroline");null!==l&&(a.layout.shapes[l].x0=a.layout.xaxis.range[0],a.layout.shapes[l].x1=a.layout.xaxis.range[1]),null!==l|null!==e&&Plotly.redraw(a),null!==l&&a.on("plotly_afterplot",function(){let e=$(a).find("g.ytick text"),t=$(a).find("path.zl");if(0==n)0<t.length&&(t[0].style.stroke=a.layout.shapes[l].line.color);else{let i;0<t.length&&(t[0].style.stroke=a.layout.yaxis.gridcolor),e.filter(function(e,t){if(this.textContent.trim().replace(",",".").replace("âˆ’","-").replace(" ","")==n){i=t.getAttribute("transform");let e=$(a).find("path.ygrid");e.filter(function(e,t){t.getAttribute("transform")==i&&(t.style.stroke=a.layout.shapes[l].line.color)})}})}})}function stringDivider(t,i,a){if(t.length>i){let e=i;for(;0<e&&" "!=t[e];e--);if(0<e)return t.substring(0,e)+a+stringDivider(t.substring(e+1),i,a);i=/( ){1,}/gi;return t.replace(i,a)}return t}function yrangeRelayout(e,i,a,n){if("[object Array]"===Object.prototype.toString.call(e["xaxis.range"])){var g=i.layout.xaxis.range,o=(i.layout.yaxis.range,[]);let l=[];if(i.data.filter(e=>!0===e.visible||!e.hasOwnProperty("visible")).forEach(e=>{for(var t=e.y.length,i=0;i<t;i++){var a=e.x[i],n=e.y[i];a>=g[0]&&a<=g[1]&&(o.push(n),"bar"==e.type&&(n={date:a,val:n},l.push(n)))}}),1==n){var r={};l.forEach(function(e){r.hasOwnProperty(e.date)&&0<e.val?r[e.date]=r[e.date]+e.val:0<e.val&&(r[e.date]=e.val)});var s,h={};for(s in l.forEach(function(e){h.hasOwnProperty(e.date)&&e.val<=0?h[e.date]=h[e.date]+e.val:e.val<=0&&(h[e.date]=e.val)}),l=[{val:0}],h)l.push({date:s,val:h[s]});for(s in r)l.push({date:s,val:r[s]});o=o.concat(l.map(e=>e.val))}let e=Math.max(...o);e=e<0?.95*e:1.05*e;let t=Math.min(...o);t=t<0?1.05*t:.95*t,n=null!=findShapeById(i,"zeroline")?{"yaxis.range":[t,e],"shapes[zline].x0":g[0]}:{"yaxis.range":[t,e]},Plotly.relayout(i,n),0<=a&&window.clearTimeout(a),a=window.setTimeout(function(){a=-1},800)}}function plotlyRelayoutEventFunction(e,t,i,a,n,l,g){timerId=0,setVerticalLayout(e,t,i,a,l,g),yrangeRelayout(e,t,timerId,n)}
