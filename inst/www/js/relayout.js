function setExternalMenu(a,b){function c(a){return null==a?[]:Array.isArray(a)?a.filter(a=>null!=a).map(a=>""+a):[""+a]}function d(a){z.textContent=a,z.style.display="block",clearTimeout(d._t),d._t=setTimeout(()=>{z.style.display="none"},1600)}function e(){q&&1!==q&&(y.textContent=`${n.selected_label||"Valittu"}: ${u.size} / ${q}`)}function f(){const a=m.querySelector(".modebar"),b=a?a.getBoundingClientRect().height:0;D.style.top=b+8+"px"}function g(){if(u.size===t.length)return null;const a=Array.from(u);if(1===q)return`${n.col}: ${a[0]??""}`.trim();const b=a.slice(0,3),c=a.length-b.length;return`${n.col}: ${b.join(", ")}${0<c?` (+${c})`:""}`}function h(a=!1){const b=g(),c=Array.from(u).sort().join("\\u0001"),d=c!==G;return G=c,d&&(C=!1),b&&(!C||a)?void(E.textContent=b,D.style.display="flex",f()):void(D.style.display="none")}function i(){return A?q?void(0===u.size?A.textContent=n.select||`Valitse (${Math.min(q,t.length)})`:A.textContent=n.deselect||"Poista valinnat"):void(A.textContent=u.size===t.length?n.deselect||"Poista valinnat":n.select||"Valitse kaikki"):void 0}function j(){const a=(m.data||[]).find(a=>"bar"===a.type);return a?"h"===a.orientation?"yaxis":"xaxis":null}function k(){const a=m.data.map((a,b)=>b),b={x:[],y:[]},c=s.some(a=>a.text),d=s.some(a=>a.hovertext);c&&(b.text=[]),d&&(b.hovertext=[]);for(let a=0;a<s.length;a++){const e=s[a],f=[];for(let a=0;a<e.filterMulti.length;a++){const b=e.filterMulti[a];b.some(a=>u.has(a))&&f.push(a)}b.x.push(f.map(a=>e.x[a])),b.y.push(f.map(a=>e.y[a])),c&&b.text.push(e.text?f.map(a=>e.text[a]):null),d&&b.hovertext.push(e.hovertext?f.map(a=>e.hovertext[a]):null)}const f=j();if(f){const a=new Set;for(let c=0;c<b.x.length;c++){const d=m.data[c]||{};if("bar"!==d.type)continue;const e="h"===d.orientation?b.y[c]:b.x[c];(e||[]).forEach(b=>a.add(b))}const c=Array.from(a).sort((c,a)=>(""+c).localeCompare(""+a)),d={};d[f+".categoryorder"]="array",d[f+".categoryarray"]=c,Plotly.relayout(m,d)}Plotly.restyle(m,b,a),Plotly.relayout(m,{autosize:!0}),e(),i(),h()}function l(){if(B.innerHTML="",t.forEach(a=>{const b=document.createElement("label");b.style.cssText=`
        display:flex;
        align-items:center;
        gap:6px;
        cursor:pointer;
        width:clamp(120px, 22vw, 240px);
      `;const c=document.createElement("input");c.type="checkbox",c.checked=u.has(a),c.style.accentColor=n.checkmark?.color||"#666",c.style.transform="scale("+(n.checkmark?.size||1)+")",c.addEventListener("change",()=>{if(1===q)return c.checked?(u.clear(),u.add(a)):u.delete(a),l(),void k();if(c.checked){if(q&&u.size>=q)return c.checked=!1,void d(n.limit_reached||`Enintään ${q} valintaa`);u.add(a)}else u.delete(a);k()});const e=document.createElement("span");e.textContent=a,b.appendChild(c),b.appendChild(e),B.appendChild(b)}),!0===n.title){const a=document.createElement("div");a.textContent=n.col,a.style.cssText=`
        width:100%;
        text-align:left;
        font-weight:bold;
        margin-bottom:${n.btn?.font.size?Math.round(n.btn.font.size/2)+"px":"5px"};
        font-size:${n.btn?.font.size?n.btn.font.size+2+"px":"inherit"};
      `,B.prepend(a)}e(),i()}const m=a,n=b.roboplot_externalmenu;if(!n||!n.col)return;const o=a=>Array.from(new Set(a)),p=a=>Array.isArray(a)?a:null==a?[]:[a],q=n["max-items"]??null,r=(m.data||[]).map(a=>{const b=a&&a.meta&&a.meta.extmenu_full?a.meta.extmenu_full:a,d=p(b.x??[]),e=p(b.y??[]),f=Math.max(d.length,e.length),g=p(b.customdata??[]),h=[];for(let b=0;b<f;b++)h.push(c(g[b]));const i=p(b.text??null),j=p(b.hovertext??null);return{x:d.slice(),y:e.slice(),filterMulti:h,text:i.length===f?i.slice():null,hovertext:j.length===f?j.slice():null}});m._extmenu_original=r;for(let c=0;c<(m.data||[]).length;c++){const a=m.data[c];a&&a.meta&&a.meta.extmenu_full&&(delete a.meta.extmenu_full,0===Object.keys(a.meta).length&&delete a.meta)}const s=m._extmenu_original||r,t=o(s.flatMap(a=>a.filterMulti.flatMap(a=>a))).sort((c,a)=>c.localeCompare(a)),u=new Set(function(){if(!q)return t.slice();if(null!=n.selected){const a=p(n.selected).filter(a=>null!=a).map(a=>""+a),b=[],c=new Set;for(const d of a)if(!c.has(d)&&t.includes(d)&&(b.push(d),c.add(d),b.length>=q))break;return b}const a=[],b=new Set;for(let c=0;c<s.length&&a.length<q;c++){const d=o(s[c].filterMulti.flat());for(const c of d)if(!b.has(c)&&(a.push(c),b.add(c),a.length>=q))break}return 0===a.length?t.slice(0,Math.min(q,t.length)):a}());m.style.position=m.style.position||"relative";const v=document.createElement("div");v.id=n.id,v.style.cssText=`
    position:absolute;
    top:6%;
    left:6%;
    width:50%;
    max-height:80%;
    overflow:auto;
    z-index:9999;
    display:none;
    background:${n.box?.background||"#fff"};
    border:${n.box?.border?`${n.box.border_width}px solid ${n.box.border}`:"none"};
    box-shadow:0 4px 8px ${n.box?.background||"#000"};
    font-family:${n.box?.font.family||"inherit"};
    padding:10px;
    border-radius:8px;
  `,m.appendChild(v),function(a,b){a.style.cursor="default";const c=document.createElement("div");c.className="drag-bar",c.style.cssText=`
      width:100%;
      cursor:move;
      user-select:none;
      margin-bottom:6px;
      font-weight:bold;
    `,c.innerHTML=n.grip||c.textContent,a.prepend(c);let d,f,g,h,i=!1;c.addEventListener("mousedown",c=>{i=!0,d=c.clientX,f=c.clientY;const e=a.getBoundingClientRect(),j=b.getBoundingClientRect();g=e.left-j.left,h=e.top-j.top,document.body.style.userSelect="none"}),document.addEventListener("mousemove",c=>{if(!i)return;const e=c.clientX-d,j=c.clientY-f,k=b.getBoundingClientRect();let l=g+e,m=h+j;l=Math.max(0,Math.min(l,k.width-a.offsetWidth)),m=Math.max(0,Math.min(m,k.height-a.offsetHeight)),a.style.left=l+"px",a.style.top=m+"px"}),document.addEventListener("mouseup",()=>{i=!1,document.body.style.userSelect=""})}(v,m);const w=document.createElement("span");w.innerHTML=n.close||"&times;",w.style.cssText=`
    position:sticky;
    top:0;
    float:right;
    cursor:pointer;
    margin-bottom: 5px;
    line-height:1;
    margin-left:10px;
    border-radius:50%;
  `,n.btn?.background&&(w.style.background=n.btn.background),n.btn?.font.size&&(w.style.fontSize=n.btn.font.size+"px"),n.box?.font.color&&(w.style.color=n.btn.font.color),n.box?.font.family&&(w.style.fontFamily=n.btn.font.family),w.addEventListener("click",()=>{v.style.display="none"}),v.querySelector(".drag-bar")?.appendChild(w);const x=document.createElement("div");x.style.cssText=`
    width:100%;
    margin: 4px 0 10px 0;
    font-size: 0.95em;
    opacity: 0.9;
  `;const y=document.createElement("div"),z=document.createElement("div");z.style.cssText=`margin-top:4px; display:none;`,x.appendChild(y),x.appendChild(z),q&&1!==q&&v.appendChild(x);let A=null;1===q||(A=document.createElement("button"),A.style.cssText=`
      width:100%;
      padding:8px 10px;
      margin-bottom:10px;
      cursor:pointer;
      border-radius:6px;
      border:${n.btn?.border?`${n.btn.border_width}px solid ${n.btn.border}`:"none"};
    `,n.btn?.background&&(A.style.background=n.btn.background),n.btn?.font.size&&(A.style.fontSize=n.btn.font.size+"px"),n.btn?.font.color&&(A.style.color=n.btn.font.color),n.btn?.font.family&&(A.style.fontFamily=n.btn.font.family),v.appendChild(A));const B=document.createElement("div");B.style.cssText="display:flex; flex-wrap:wrap; gap:8px 16px; width:100%; align-items:flex-start;",v.appendChild(B);let C=!1;const D=document.createElement("div");D.id=n.id?n.id+"-chip":"roboplot-chip",D.style.cssText=`
  position:absolute;
  right:8px;
  z-index:9998;
  max-width:60%;
  display:none;
  align-items:center;
  gap:8px;
  padding:6px 10px;
  border-radius: 8px;
  opacity: 0.7;
  background:${n.box?.background||"#fff"};
  border:${n.box?.border?`${n.box.border_width}px solid ${n.box.border}`:"none"};
  box-shadow:0 4px 8px ${n.box?.background||"#000"};
  font-family: ${n.box?.font.family||"inherit"};
  font-size: ${n.box?.font.size||12}px;
  line-height:1.2;
  user-select:none;
  white-space:nowrap;
  overflow:hidden;
`,m.appendChild(D);const E=document.createElement("span");E.style.cssText=`
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
`,D.appendChild(E);const F=document.createElement("span");F.innerHTML=n.close||"&times;",F.style.cssText=`
  cursor:pointer;
  line-height:1;
  margin-left:2px;
  border-radius:50%;
  flex:0 0 auto;
`,n.btn?.background&&(F.style.background=n.btn.background),n.btn?.font?.size&&(F.style.fontSize=n.btn.font.size+"px"),n.btn?.font?.color&&(F.style.color=n.btn.font.color),n.btn?.font?.family&&(F.style.fontFamily=n.btn.font.family),D.appendChild(F),E.style.cursor="pointer",E.addEventListener("click",()=>{v.style.display="block"}),F.addEventListener("click",a=>{a.stopPropagation(),C=!0,D.style.display="none"}),m.on("plotly_relayout",f),window.addEventListener("resize",f);let G=null;A&&A.addEventListener("click",()=>{if(!q)u.size===t.length?u.clear():t.forEach(a=>u.add(a));else if(0<u.size)u.clear();else{const a=[],b=new Set;for(let c=0;c<s.length&&a.length<q;c++){const d=o(s[c].filterMulti.flat());for(const c of d)if(!b.has(c)&&(a.push(c),b.add(c),a.length>=q))break}0===a.length?t.slice(0,Math.min(q,t.length)).forEach(a=>u.add(a)):a.forEach(a=>u.add(a))}l(),k()}),l(),k()}function rangeSliderShowHide(a,b=!0){"rangeslider"in a.layout.xaxis?a.layout.xaxis.rangeslider.visible==b?Plotly.relayout(a,{showlegend:b}):Plotly.relayout(a,{showlegend:b,"xaxis.rangeslider.visible":b}):Plotly.relayout(a,{showlegend:b})}function rangeSliderHeight(a){let b=0;if("rangeslider"in a.layout.xaxis&&!0==a.layout.xaxis.rangeslider.visible){elslider_container=$(a).find(".rangeslider-bg")[0].getBBox().height,b=elslider_container+.1*a.layout.margin.t+.1*a.layout.margin.b;let c=$(a).find("g.xaxislayer-above");0<c.length&&(c=$(a).find("g.xaxislayer-above")[0].getBBox().height,b+=c/10)}return b}function findModeBarHeight(a){let b=5,c=$(a).find("div.modebar");return 0<c.length&&"none"!=c.css("display")&&(b=c[0].clientHeight),b}function getVerticalLayout(a,b,c=!1,d,e,f=void 0,g=!1,h="auto"){const i=a=>/<br>/.test(a)?11:16;adjustLegendItems(a,g);let j={height:$(a).find("svg.main-svg")[0].height.animVal.value,width:$(a).find("svg.main-svg")[0].width.animVal.value},k=$(a).find("g.g-gtitle")[0].getBBox(),l=!!(0<$(a).find("g.xy2").length),m=!!(0<$(a).find("g.g-y2title").length),n=rangeSliderHeight(a),o=e?5:0,p=$(a).find("g.xaxislayer-above");p=0<p.length?p[0].getBBox().height:o;let q=findModeBarHeight(a),r=5;if(l){let b=$(a).find("g.overaxes-above > g.xy2-y")[0].getBBox(),c=m?$(a).find("g.g-y2title")[0].getBBox().width:0;r=b.width+5+c}let s=k.height+q+i(a.layout.title.text),t=$(a).find("g.annotation")[0].getBBox().height+5,u=$(a).find("g.g-xtitle");u=0<u.length?1.3*u[0].getBBox().height:0;let v={width:0,height:0};if($(a).find("g.legend")[0]!=null){let b=$(a).find("g.legend")[0].getBBox();v.height=b.height,v.width=b.width}let w=e?$(a).find(".pielayer"):$(a).find(".nsewdrag");0<w.length&&(w=w[0].getBBox());"auto"==h&&("right"==a.layout.legend.position?h=.67>w.width/j.width||.75>w.width/v.width?"bottom":"right":h=.75<w.width/j.width||1.2<w.width/v.width?"right":"bottom");let x="bottom"==h?"h":"v";if($(a).find("g.legend")[0]!=null){let b=$(a).find("g.legend")[0].getBBox();v.height="right"==h?0:Math.ceil(b.height),v.width=b.width}a.layout.legend.position=h;let y="bottom"==h?0:1.02,z=v.height+15+(t+p+u);e&&(w.height=j.height-z-s),0==w.height&&(w.height=1);let A=$(a).find("g.layer-above > g.imagelayer > image")[0].getBBox(),B=logoSpace(f,A,z,u,p,v,x,w.height);z+=B;let C=2*b.legend/w.height;a.layout.images[0].sizey=C;let D="right"==h?1:-((p+10+n+u)/w.height);if(-2>D||w.height<j.height/4){rangeSliderShowHide(a,!1),n=0,p=$(a).find("g.xaxislayer-above"),p=0<p.length?p[0].getBBox().height:o;z=15+t+p+u;let c=e?$(a).find(".pielayer"):$(a).find(".nsewdrag");0<c.length&&(c=c[0].getBBox());e&&(c.height=j.height-z-s),0==c.height&&(c.height=1),C=2*b.legend/c.height,a.layout.images[0].sizey=C,D="right"==h?1:-((p+10+n+u)/c.height)}else if(w.height>j.height/1.5&!1==a.layout.showlegend){rangeSliderShowHide(a,!0),n=rangeSliderHeight(a);let c=$(a).find("g.xaxislayer-above");c=0<c.length?c[0].getBBox().height:o;let d=findModeBarHeight(a),f=k.height+d+i(a.layout.title.text),g=$(a).find("g.annotation")[0].getBBox().height+5,l=$(a).find("g.g-xtitle");l=0<l.length?1.3*l[0].getBBox().height:0,v={width:0,height:0},$(a).find("g.legend")[0]!=null&&(v.height="bottom"==h?Math.ceil($(a).find("g.legend")[0].getBBox().height):0,v.width=$(a).find("g.legend")[0].getBBox().width);z=v.height+15+(g+c+l),w=e?$(a).find(".pielayer"):$(a).find(".nsewdrag"),0<w.length&&(w=w[0].getBBox());e&&(w.height=j.height-z-f),0==w.height&&(w.height=1),A=$(a).find("g.layer-above > g.imagelayer > image")[0].getBBox(),C=2*b.legend/w.height,a.layout.images[0].sizey=C,D=-((c+10+n+l)/w.height)}w=e?$(a).find(".pielayer"):$(a).find(".nsewdrag"),0<w.length&&(w=w[0].getBBox());e&&(w.height=j.height-z-s),0==w.height&&(w.height=1);let E=v.height>w.height/2?b.legend-2:b.legend;E=v.width>$(a).find("svg.main-svg")[0].width.animVal.value?E-2:E;let F=b.y,G=$(a).find("g.yaxislayer-above");if(0<G.length){let c=$(a).find("g.ytick"),d=[...c].reduce((c,a)=>c+a.getBBox().height,0);F=w.height<=d?Math.floor(.8*a.layout.yaxis.tickfont.size):Math.min(Math.floor(1.5*a.layout.yaxis.tickfont.size),b.y);let e=G[0].getBBox().width;"container"==a.layout.annotations[0].xmod&&(a.layout.annotations[0].xshift=-e),"container"==a.layout.legend.xmod&&"bottom"==h&&(y=-(e/w.width))}let H={"legend.orientation":x,"legend.x":y,"legend.y":D,"images[0].sizey":C,"margin.t":s,"margin.b":z,"margin.r":r,"legend.font.size":E,"yaxis.tickfont.size":F,"yaxis2.tickfont.size":F},I=d.reduce(function(a,b){return b in H&&(a[b]=H[b]),a},{});return I}function calculateDisplayedImageSize(a,b){let c,d,e=b.width/b.height;e>a?(d=b.height,c=d*a):(c=b.width,d=c/a);let f={width:Math.round(c),height:Math.round(d)};return f}function logoSpace(a,b,c,d,e,f,g,h){let i=calculateDisplayedImageSize(a,b),j=[],k="bottom"==g?f.width:0;return j.horizontal=b.width-f.width-i.width,j.vertical=c-(d+e+f.height)-i.height,Object.values(j).every(a=>0>a)?-j.vertical>h/3?0:-j.vertical:0}function adjustLegendItems(a,b=!0){let c=$(a).find(".legend .legendtext");if(b){let b=a.data.reduce((a,b)=>{let d=c.filter(function(){return $(this).text()===b.name});if(0<d.length){let b=d[0].getBBox().width;return Math.max(a,b)}return a},0);b=Math.round(1.02*b),a.layout.legend.entrywidth=b}else{let b=$(a).find(".legend .legendtext");a.data.forEach(a=>{let c=b.filter(function(){return $(this).text()===a.name});if(0<c.length){let b=c[0].getBBox().width;a.legendwidth=Math.round(1.1*b)}})}}function setVerticalLayout(a,b,c,d,e,f=void 0,g=!1,h="auto"){if("width"in a|"autosize"in a){"rangeslider"in b.layout.xaxis&&!1==b.layout.xaxis.rangeslider.visible&&(b.layout.xaxis.rangeslider.visible=!0);let a="<span>"+(d[2]?"<b>":"")+d[0]+(d[2]?"</b>":"")+(0==d[0].length?"":"<br>")+"<span style='font-size: 75%'>"+d[1]+"</span></span>",i=b.layout.annotations[0].text.replace(/<br class = 'roboplotr-breaker'>/g," ");Plotly.relayout(b,{"title.text":a,"annotations[0].text":i});let j=$(b).find("g.g-gtitle")[0].getBBox().width,k=e?$(b).find("g.layer-above"):$(b).find(".nsewdrag");0<k.length&&(k=k[0].getBBox().width);let l=getVerticalLayout(b,c,!1,keys=["legend.font.size","margin.t","margin.b","legend.orientation","legend.x","legend.y","yaxis.tickfont.size","yaxis2.tickfont.size"],e=e,f=f,g=g,h=h);k<=j&&(a="<span>"+(d[2]?"<b>":"")+stringDivider(d[0],Math.floor(k/(b.layout.title.font.size-8)),"<br class = 'roboplotr-breaker'>")+(d[2]?"</b>":"")+"<br><span style='font-size: 75%'>"+d[1]+"</span></span>",l["title.text"]=a),rangeSliderShowHide(b,!0),Plotly.relayout(b,l);calculateDisplayedImageSize(f,$(b).find("g.layer-above > g.imagelayer > image")[0].getBBox()).width;l=getVerticalLayout(b,c,!1,keys=["legend.font.size","legend.orientation","legend.x","legend.y","margin.t","margin.b","margin.r","yaxis.tickfont.size","yaxis2.tickfont.size","images[0].sizey"],e=e,f=f,g=g,h=h),l=findCaptionSpace(b,f,e,l,k),Plotly.relayout(b,l),l=getVerticalLayout(b,c,!1,keys=["legend.font.size","legend.orientation","legend.x","legend.y","margin.t","margin.b","margin.r","yaxis.tickfont.size","yaxis2.tickfont.size","images[0].sizey"],e=e,f=f,g=g,h=h),l=findCaptionSpace(b,f,e,l,k),Plotly.relayout(b,l),l=getVerticalLayout(b,c,!1,keys=["legend.font.size","margin.t","margin.b","legend.orientation","legend.x","legend.y","images[0].sizey","yaxis.tickfont.size","yaxis2.tickfont.size"],e=e,f=f,g=g,h=h),l=findCaptionSpace(b,f,e,l,k),Plotly.relayout(b,l),l=getVerticalLayout(b,c,!1,keys=["legend.font.size","margin.t","margin.b","legend.orientation","legend.x","legend.y","images[0].sizey","yaxis.tickfont.size","yaxis2.tickfont.size"],e=e,f=f,g=g,h=h),Plotly.relayout(b,l),setUpdatemenuPosition(b)}}function setUpdatemenuPosition(a){if(0<$(a).find("g.updatemenu-container").length){let b=$(a).find(".nsewdrag")[0].getBBox(),c=$(a).find("g.updatemenu-container")[0].getBBox(),d="top"==a.layout.updatemenus[0].yanchor?.98:.02,e="left"==a.layout.updatemenus[0].xanchor?.02:.98;Plotly.relayout(a,{"updatemenus[0].y":d,"updatemenus[0].x":e})}}function setYPositions(a,b,c=!1){if("width"in a|"autosize"in a){let a=$(b).find("svg.main-svg")[0].height.animVal.value,d=findModeBarHeight(b),e=c?$(b).find(".pielayer"):$(b).find(".nsewdrag");0<e.length&&(e=e[0].getBBox());let f=b.layout.margin.b,g=b.layout.margin.t;c&&(e.height=a-f-g);let h=a-e.height-b.layout.margin.t,i=Math.round(a-g-f);if(!0===c){let c=$(b).find("svg.main-svg")[0].width.animVal.value;i>Math.round(e.height)&&a>2*c&&(h-=i-e.height,e.height+=i-e.height)}let j=-(h/e.height);Plotly.relayout(b,{"images[0].y":j,"annotations[0].y":j,"title.y":(a-(21+d))/a})}}function findCaptionSpace(a,b,c,d,e){let f,g=$(a).find("g.annotation")[0].getBBox().width,h=a.layout.annotations[0].text.replace(/<br class = 'roboplotr-breaker'>/g," ");if(c)f=e;else{let c=$(a).find(".nsewdrag")[0].getBBox().width,d=calculateDisplayedImageSize(b,$(a).find("g.layer-above > g.imagelayer > image")[0].getBBox()).width;f=Math.max(c-d,Math.round(d/2))}return d["annotations[0].text"]=stringDivider(h,Math.floor(f/(a.layout.annotations[0].font.size/2)),"<br class = 'roboplotr-breaker'>"),d}function findAnnotationById(a,b){let c=a.layout.annotations||[];for(let d=0;d<c.length;d++)if(c[d].annotationId===b)return d;return null}function findShapeById(a,b){let c=a.layout.shapes||[];for(let d=0;d<c.length;d++)if(c[d].shapeId===b)return d;return null}function editShapes(a,b){let c=findShapeById(a,"shadearea");null!==c&&(a.layout.shapes[c].y0=a.layout.yaxis.range[0],a.layout.shapes[c].y1=a.layout.yaxis.range[1],!0==a.layout.shapes[c].xnull&&(a.layout.shapes[c].x1=a.layout.xaxis.range[1]));let e=findShapeById(a,"zeroline");null!==e&&(a.layout.shapes[e].x0=a.layout.xaxis.range[0],a.layout.shapes[e].x1=a.layout.xaxis.range[1]),null!==e|null!==c&&Plotly.redraw(a),null!==e&&a.on("plotly_afterplot",function(){let c=$(a).find("g.ytick text"),d=$(a).find("path.zl");if(0==b)0<d.length&&(d[0].style.stroke=a.layout.shapes[e].line.color);else{let f;0<d.length&&(d[0].style.stroke=a.layout.yaxis.gridcolor);c.filter(function(c,d){if(this.textContent.trim().replace(",",".").replace("\u2212","-").replace(" ","")==b){f=d.getAttribute("transform");let b=$(a).find("path.ygrid");b.filter(function(b,c){c.getAttribute("transform")==f&&(c.style.stroke=a.layout.shapes[e].line.color)})}})}})}function stringDivider(a,b,c){const d=a.split("<br>"),e=a=>{if(a.length>b){let d=b;for(;0<d&&" "!==a[d];)d--;if(0<d){const b=a.substring(0,d),f=a.substring(d+1);return b+c+e(f)}else{return a.replace(/( ){1,}/ig,c)}}return a},f=d.map(e);return f.join("<br>")}function yrangeRelayout(a,b,c,d){if("[object Array]"===Object.prototype.toString.call(a["xaxis.range"])|"xaxis.range[0]"in a|"xaxis.autorange"in a){var e=b.layout.xaxis.range,f=b.layout.yaxis.range,g=[];let f=[];var h=[],i=b.data.filter(a=>!0===a.visible||!a.hasOwnProperty("visible"));if(i.forEach(a=>{var c=a.y.length;h.push(a.type);for(var d=0;d<c;d++){var j=a.x[d],k=a.y[d];if((j>=e[0]&&j<=e[1]||"category"==b.layout.xaxis.type)&&(g.push(k),"bar"==a.type)){f.push({date:j,val:k})}}}),!0==d){var j={};f.forEach(function(a){j.hasOwnProperty(a.date)&&0<a.val?j[a.date]=j[a.date]+a.val:0<a.val&&(j[a.date]=a.val)});var k={};for(var l in f.forEach(function(a){k.hasOwnProperty(a.date)&&0>=a.val?k[a.date]=k[a.date]+a.val:0>=a.val&&(k[a.date]=a.val)}),f=[{val:0}],k)f.push({date:l,val:k[l]});for(var l in j)f.push({date:l,val:j[l]});g=g.concat(f.map(a=>a.val))}let n,o;if("xaxis.autorange"in a)n=b._init_yrange.x1,o=b._init_yrange.x0;else{n=Math.max(...g),o=Math.min(...g);let a=.04*Math.abs(n-o);n+=a;let b=h.includes("bar")&&g.every(a=>0<=a);!0!=d&&!1==b&&(o-=a)}let p=findShapeById(b,"zeroline"),q=findShapeById(b,"shadearea");var m={"yaxis.range":[o,n]};null!=p&&("xaxis.autorange"in a?(m["shapes["+p+"].x0"]=b._init_xrange.x0,m["shapes["+p+"].x1"]=b._init_xrange.x1):(m["shapes["+p+"].x0"]=e[0],m["shapes["+p+"].x1"]=e[1])),null!=q&&(!0==b.layout.shapes[q].xnull&&("xaxis.autorange"in a?m["shapes["+q+"].x1"]=b._init_xrange.x1:m["shapes["+q+"].x1"]=e[1]),m["shapes["+q+"].y0"]=o,m["shapes["+q+"].y1"]=n),Plotly.relayout(b,m),0<=c&&window.clearTimeout(c),c=window.setTimeout(function(){c=-1},800)}}function plotlyRelayoutEventFunction(a,b,c,d,e,f,g,h,i){timerId=0,setVerticalLayout(a,b,c,d,f,g,h,i),setYPositions(a,b,f),yrangeRelayout(a,b,timerId,e)}